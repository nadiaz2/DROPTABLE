<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<img class="image" src="body.png" alt="body">
<button class="home" type="button" onclick="window.location.href='game1.html'">Home</button>
</body>
<script>
    window.onload = async function (e) {
        e.preventDefault();
        let webSocket = new WebSocket('wss://' + window.location.host);

        //receiving
        webSocket.onmessage = (event) => {
            let pc_message = JSON.parse(event.data);
            //TODO: insert if and href here
            //json convert to variables
            console.log(pc_message);
        };

        await until(() => webSocket.readyState === WebSocket.OPEN);

        await new Promise(r => setTimeout(r, 3000));

        const obj = {name: "MiniGameEnd", message: 1};
        webSocket.send(JSON.stringify(obj));

        window.addEventListener("deviceorientation", handleOrientation);
    }

    function handleOrientation(event){
        if (event.beta > 100 || event.beta < -100){
            window.location.href = 'pause.html';
        }
    }

    function until(conditionFunction) {

        const poll = resolve => {
            if (conditionFunction()) resolve();
            else setTimeout(_ => poll(resolve), 100);
        }

        return new Promise(poll);

    }
</script>
<style>
    .image{
        width: 100%;
        height: 70%;
        position: absolute;
        overflow: auto;
        float: right;
    }
    .home{
        float: right;
        width: 100%;
        margin-right: 0;
        font-size: 30px;
        height: 5%;
        overflow: auto;
        position: absolute;
        right:    0;
        bottom:   0;
    }
</style>
</html>

